1. Архитектура взаимодействия

 Python не работает с БД напрямую - обязательно требуется драйвер
 Для PostgreSQL используется psycopg2 (или psycopg3 - современная версия)
 Почему psycopg2:
  Стабильный и проверенный
  Широкая распространённость
  Идеален для обучения


2. Установка

pip install psycopg2-binary

3. Подключение к БД

import psycopg2

conn = psycopg2.connect(
  host="localhost",
  database="mydb",
  user="user",
  password="pass"
)
cursor = conn.cursor()
 conn - объект соединения с БД
 cursor - объект для выполнения SQL-запросов


4. Основные операции

SELECT

cursor.execute("SELECT * FROM categories")
rows = cursor.fetchall()  # все строки в виде кортежей
INSERT

cursor.execute(
  "INSERT INTO categories (name) VALUES (%s)",
  ("Новая категория",)
)
 %s - параметризованный запрос
 Защита от SQL-инъекций
 Автоматическое экранирование

UPDATE

cursor.execute(
  "UPDATE categories SET name = %s WHERE id = %s",
  ("Обновлённое имя", 1)
)
DELETE

cursor.execute(
  "DELETE FROM categories WHERE id = %s",
  (1,)  # кортеж с одним элементом (обязательна запятая)
)

5. Транзакции

 PostgreSQL работает в транзакциях
 Изменения не фиксируются автоматически
 commit() - сохранить изменения
 rollback() - откатить изменения

conn.commit()  # фиксация
conn.rollback() # откат

6. Закрытие соединения

cursor.close()
conn.close()
Важно: предотвращает утечки соединений, критично для GUI-приложений


7. Типичная структура кода

import psycopg2

conn = psycopg2.connect(...)
cursor = conn.cursor()

try:
  cursor.execute("SELECT * FROM recipes")
  print(cursor.fetchall())
finally:
  cursor.close()
  conn.close()
